<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>:::AICLUDE EdgeHD:::</title>
    {% if work_id %}
    <meta name="work-id" content="{{ work_id }}" />
    {% endif %} {% if work_data %}
    <script>
      // ÏÑúÎ≤ÑÏóêÏÑú Ï†ÑÎã¨Îêú work_dataÎ•º JavaScript Î≥ÄÏàòÎ°ú ÏßÅÏ†ë ÏÑ§Ï†ï
      window.serverWorkData = {{ work_data | tojson | safe }};
      console.log("üîó ÏÑúÎ≤ÑÏóêÏÑú ÏßÅÏ†ë Ï†ÑÎã¨Îêú work_data:", window.serverWorkData);
    </script>
    {% endif %}
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
      }

      .header {
        text-align: center;
        padding: 20px;
        color: white;
      }

      .header h1 {
        font-size: 2.5em;
        font-weight: 700;
        margin-bottom: 10px;
      }

      /* Î™®Îìú Ï†ÑÌôò ÌÉ≠ */
      .mode-tabs {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
      }

      .mode-tab {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 20px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .mode-tab:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .mode-tab.active {
        background: white;
        color: #667eea;
        border-color: white;
      }

      .main-container {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        padding: 0 20px 20px;
        max-height: calc(100vh - 160px);
        min-height: 500px;
        transition: grid-template-columns 0.3s ease;
      }

      .main-container.upload-only {
        grid-template-columns: 1fr;
        justify-items: center;
      }

      .left-panel {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 350px;
        position: relative;
      }

      .right-panel {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 350px;
        position: relative;
        transition: all 0.3s ease;
      }

      .right-panel.visible {
        display: flex;
      }

      /* ÏóÖÎ°úÎìú ÏòÅÏó≠ */
      .upload-area {
        border: 3px dashed #ddd;
        border-radius: 12px;
        padding: 40px 15px;
        transition: all 0.3s ease;
        cursor: pointer;
        background: #fafafa;
        text-align: center;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .upload-area:hover {
        border-color: #667eea;
        background: #f0f4ff;
      }

      .upload-area.dragover {
        border-color: #667eea;
        background: #e8f0ff;
        transform: scale(1.02);
      }

      .upload-icon {
        font-size: 3em;
        color: #ddd;
        margin-bottom: 20px;
      }

      .upload-text {
        color: #666;
        font-size: 1.2em;
        margin-bottom: 10px;
      }

      .upload-subtext {
        color: #999;
        font-size: 0.9em;
      }

      #fileInput,
      #videoFileInput {
        display: none;
      }

      /* ÎπÑÎîîÏò§ Î™®Îìú UI */
      .video-mode {
        display: none;
      }

      .video-mode.active {
        display: block;
      }

      .image-mode.hidden {
        display: none;
      }

      .video-upload-area {
        border: 3px dashed #ddd;
        border-radius: 12px;
        padding: 40px 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f9f9f9;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .video-upload-area:hover {
        border-color: #aaa;
        background: #f0f0f0;
      }

      .video-upload-area.dragover {
        border-color: #667eea;
        background: #e8f0ff;
        transform: scale(1.02);
      }

      .video-options {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .option-group {
        margin-bottom: 15px;
      }

      .option-group label {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: background 0.2s ease;
      }

      .option-group label:hover {
        background: #f5f5f5;
      }

      .option-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
      }

      .scale-options {
        display: none;
        margin-left: 30px;
        margin-top: 10px;
        gap: 10px;
      }

      .scale-options.visible {
        display: flex;
      }

      .scale-option label {
        background: #f0f0f0;
        padding: 5px 15px;
        border-radius: 15px;
        font-size: 0.9em;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .scale-option input[type="radio"] {
        margin-right: 5px;
      }

      .scale-option label:hover {
        background: #e0e0e0;
      }

      /* ÎπÑÎîîÏò§ Ï†ïÎ≥¥ Ïπ¥ÎìúÎì§ (ÏôºÏ™Ω Ìå®ÎÑêÏóê Í∞ÄÎ°ú Î∞∞Ïπò) */
      .video-info-container {
        display: flex;
        gap: 15px;
        margin: 15px 0;
        flex-wrap: wrap;
      }

      .video-info-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 200px;
      }

      .video-info-title {
        font-size: 1em;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .video-info-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 6px;
        font-size: 0.85em;
      }

      .video-info-label {
        color: #666;
        font-weight: 500;
      }

      .video-info-value {
        color: #333;
        font-weight: 600;
      }

      /* Î∞∞Í≤Ω ÏÉâÏÉÅ ÏÑ†ÌÉù ÌåùÏóÖ */
      .background-color-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
      }

      .popup-content {
        background: white;
        border-radius: 15px;
        padding: 25px;
        max-width: 400px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .popup-title {
        font-size: 1.3em;
        font-weight: 700;
        color: #333;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
        color: #999;
        padding: 5px;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .close-btn:hover {
        background: #f0f0f0;
        color: #333;
      }

      .background-color-section {
        margin-bottom: 20px;
      }

      .color-section-title {
        font-weight: 600;
        margin-bottom: 15px;
        color: #333;
        font-size: 1.1em;
      }

      .preset-colors {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .color-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 3px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .color-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .color-btn.active {
        border-color: #667eea !important;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        transform: scale(1.15);
      }

      .custom-color-section {
        display: flex;
        align-items: center;
        gap: 15px;
        justify-content: center;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .custom-color-section label {
        font-weight: 600;
        color: #666;
      }

      .custom-color-picker {
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .popup-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
      }

      .popup-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
      }

      .popup-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }

      .popup-btn.cancel {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      }

      /* Ï≤òÎ¶¨ Î©îÏãúÏßÄ (Ìå®ÎÑêÏóê ÏßÅÏ†ë ÌëúÏãú) */
      .processing-message {
        background: none;
        color: #666;
        border-radius: 0;
        padding: 20px 10px;
        text-align: center;
        margin: 20px 0;
        animation: none;
        box-shadow: none;
      }

      .processing-main-message {
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 8px;
        line-height: 1.4;
        color: #333;
      }

      .processing-tip-message {
        font-size: 0.9em;
        opacity: 0.8;
        font-style: italic;
        line-height: 1.3;
        color: #666;
      }

      @keyframes fadeInMessage {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ÎπÑÎîîÏò§ ÏôÑÎ£å Í≤∞Í≥º */
      .video-result-section {
        background: none;
        color: #333;
        border-radius: 0;
        padding: 20px 10px;
        margin: 20px 0;
        text-align: center;
        animation: none;
        box-shadow: none;
      }

      .result-title {
        font-size: 1.2em;
        font-weight: 600;
        margin-bottom: 15px;
        color: #28a745;
      }

      /* Ïù¥ÎØ∏ÏßÄ ÌëúÏãú ÏòÅÏó≠ */
      .image-display-area {
        display: none;
        flex-direction: column;
        align-items: center;
        text-align: center;
        height: 100%;
      }

      .image-display-area.visible {
        display: flex;
      }

      /* ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏÉÅÌÉú ÌëúÏãú ÏòÅÏó≠ */
      .video-status-area {
        display: none;
        flex-direction: column;
        align-items: center;
        text-align: center;
        height: 100%;
        padding: 30px 15px;
        background: none;
        border-radius: 0;
        overflow-y: auto;
      }

      .video-status-area.visible {
        display: flex;
      }

      .processing-status-container {
        display: flex;
        justify-content: center;
        width: 100%;
        max-width: 350px;
        margin-bottom: 15px;
      }

      .fun-message-card {
        background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        color: white;
        border-radius: 8px;
        padding: 12px 16px;
        text-align: center;
        animation: fadeInMessage 0.5s ease-in;
        width: 100%;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .fun-message {
        font-size: 0.85em;
        line-height: 1.3;
        margin-bottom: 4px;
      }

      .fun-tip {
        font-size: 0.75em;
        opacity: 0.9;
        font-style: italic;
        line-height: 1.2;
      }

      .fun-message {
        font-size: 1em;
        line-height: 1.4;
        margin-bottom: 8px;
      }

      .fun-tip {
        font-size: 0.85em;
        opacity: 0.9;
        font-style: italic;
      }

      .video-result-area {
        background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
        color: white;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        width: 100%;
        max-width: 300px;
        text-align: center;
        animation: fadeInMessage 0.5s ease-in;
      }

      .image-container {
        position: relative;
        max-width: 100%;
        max-height: 50vh;
        margin-bottom: 15px;
      }

      .image-display {
        max-width: 100%;
        max-height: 50vh;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      /* ÎπÑÎîîÏò§ ÌëúÏãú ÏòÅÏó≠ */
      .video-display-area {
        display: none;
        flex-direction: column;
        align-items: center;
        text-align: center;
        height: 100%;
      }

      .video-display-area.visible {
        display: flex;
      }

      .video-container {
        position: relative;
        max-width: 100%;
        max-height: 50vh;
        margin-bottom: 15px;
      }

      .video-display {
        max-width: 100%;
        max-height: 50vh;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        background: #000;
      }

      .video-info-display {
        background: linear-gradient(135deg, #f8f9ff 0%, #f0f3ff 100%);
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 12px;
        font-size: 0.85em;
        color: #666;
        max-width: 100%;
        text-align: left;
      }

      .video-info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
      }

      .video-info-row:last-child {
        margin-bottom: 0;
      }

      .video-info-label {
        font-weight: 500;
      }

      .video-info-value {
        color: #333;
        font-weight: 600;
      }

      .image-label {
        margin: 12px 0 8px;
        font-weight: 600;
        color: #333;
        font-size: 1em;
      }

      /* Ïï°ÏÖò Î≤ÑÌäºÎì§ */
      .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 15px;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 100px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn.upscale-2x {
        background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      }

      .btn.upscale-4x {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .btn.background-remove {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .btn.download {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      }

      .btn.reset {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      }

      /* ÏÉâÏÉÅ ÏÑ†ÌÉù Î≤ÑÌäº */
      .color-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .color-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .color-btn.active {
        border-color: #667eea !important;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        transform: scale(1.1);
      }

      /* Î©îÏãúÏßÄ */
      .message-container {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        max-width: 90%;
      }

      .error-message {
        color: #e74c3c;
        background: #ffeaea;
        padding: 15px;
        border-radius: 10px;
        border-left: 4px solid #e74c3c;
      }

      .success-message {
        color: #27ae60;
        background: #eafaf1;
        padding: 15px;
        border-radius: 10px;
        border-left: 4px solid #27ae60;
      }

      /* Îπà ÏÉÅÌÉú */
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #999;
        height: 100%;
      }

      .empty-state.hide {
        display: none;
      }

      .empty-icon {
        font-size: 3em;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      .empty-text {
        font-size: 1.1em;
      }

      /* Ìà¨Î™ÖÎèÑ Ï≤¥ÌÅ¨Î≥¥Îìú Î∞∞Í≤Ω */
      .transparency-bg {
        background-image: linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
          linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
          linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
        background-size: 20px 20px;
        background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      }

      /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 2em;
        }

        .header {
          padding: 15px;
        }

        .main-container,
        .main-container.upload-only {
          grid-template-columns: 1fr;
          gap: 15px;
          padding: 0 15px 15px;
          max-height: none;
          justify-items: stretch;
        }

        .left-panel,
        .right-panel {
          padding: 15px;
          min-height: 250px;
        }

        .upload-area {
          padding: 30px 12px;
          min-height: 120px;
        }

        .upload-icon {
          font-size: 2.2em;
        }

        .upload-text {
          font-size: 1em;
        }

        .action-buttons {
          flex-direction: column;
          align-items: center;
        }

        .btn {
          width: 100%;
          max-width: 200px;
        }

        .image-display {
          max-height: 40vh;
        }

        .processing-status-container {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ü´• üñºÔ∏è ‚úÇÔ∏è üî• üë®üèª‚Äçüíª AICLUDE EdgeHD</h1>
      <div class="mode-tabs">
        <div class="mode-tab active" onclick="switchMode('image')">
          üñºÔ∏è Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨
        </div>
        <div class="mode-tab" onclick="switchMode('video')">üé¨ ÎπÑÎîîÏò§ Ï≤òÎ¶¨</div>
      </div>
    </div>

    <div class="main-container" id="mainContainer">
      <!-- Ï¢åÏ∏° Ìå®ÎÑê -->
      <div class="left-panel">
        <!-- Ïù¥ÎØ∏ÏßÄ Î™®Îìú -->
        <div class="image-mode" id="imageMode">
          <!-- ÏóÖÎ°úÎìú ÏòÅÏó≠ -->
          <div class="upload-area" id="uploadArea">
            <div class="upload-icon">üì∏</div>
            <div class="upload-text">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò Ïù¥ÎØ∏ÏßÄÎ•º ÎìúÎûòÍ∑∏Ìï¥Ï£ºÏÑ∏Ïöî</div>
            <div class="upload-subtext">
              PNG, JPG, JPEG, GIF, BMP, WEBP (ÏµúÎåÄ 16MB)
            </div>
          </div>
        </div>

        <!-- ÎπÑÎîîÏò§ Î™®Îìú -->
        <div class="video-mode" id="videoMode">
          <!-- ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú ÏòÅÏó≠ -->
          <div class="video-upload-area" id="videoUploadArea">
            <div class="upload-icon">üé¨</div>
            <div class="upload-text">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÎπÑÎîîÏò§Î•º ÎìúÎûòÍ∑∏Ìï¥Ï£ºÏÑ∏Ïöî</div>
            <div class="upload-subtext">MP4, AVI, MOV, MKV (ÏµúÎåÄ 100MB)</div>
          </div>
        </div>

        <!-- Ïù¥ÎØ∏ÏßÄ ÌëúÏãú ÏòÅÏó≠ -->
        <div class="image-display-area" id="leftImageArea">
          <div class="image-container">
            <img id="leftImage" class="image-display" alt="ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ" />
          </div>
          <div class="image-label" id="leftImageLabel">ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ</div>
          <div class="action-buttons" id="leftActionButtons">
            <button class="btn upscale-2x" onclick="processImage('upscale', 2)">
              üîç 2x ÏóÖÏä§ÏºÄÏùº
            </button>
            <button class="btn upscale-4x" onclick="processImage('upscale', 4)">
              üîç 4x ÏóÖÏä§ÏºÄÏùº
            </button>
            <button
              class="btn background-remove"
              onclick="processImage('background')"
            >
              ü´• Î∞∞Í≤Ω Ï†úÍ±∞
            </button>
          </div>
        </div>

        <!-- ÎπÑÎîîÏò§ ÌëúÏãú ÏòÅÏó≠ -->
        <div class="video-display-area" id="leftVideoArea">
          <div class="video-container">
            <video
              id="leftVideo"
              class="video-display"
              controls
              alt="ÏóÖÎ°úÎìúÎêú ÎπÑÎîîÏò§"
            >
              Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÎπÑÎîîÏò§ Ïû¨ÏÉùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
            </video>
          </div>

          <div class="image-label" id="leftVideoLabel">ÏóÖÎ°úÎìúÎêú ÎπÑÎîîÏò§</div>

          <!-- ÎπÑÎîîÏò§ Ï†ïÎ≥¥ Ïπ¥ÎìúÎì§ (Í∞ÄÎ°ú Î∞∞Ïπò) -->
          <div class="video-info-container">
            <!-- ÏõêÎ≥∏ ÎπÑÎîîÏò§ Ï†ïÎ≥¥ -->
            <div class="video-info-card">
              <div class="video-info-title">üìπ ÏõêÎ≥∏ ÎπÑÎîîÏò§</div>
              <div class="video-info-item">
                <span class="video-info-label">ÌååÏùº Ìè¨Îß∑:</span>
                <span class="video-info-value" id="videoFormat">-</span>
              </div>
              <div class="video-info-item">
                <span class="video-info-label">Ìï¥ÏÉÅÎèÑ:</span>
                <span class="video-info-value" id="videoResolution">-</span>
              </div>
              <div class="video-info-item">
                <span class="video-info-label">ÌîÑÎ†àÏûÑÏú®:</span>
                <span class="video-info-value" id="videoFPS">-</span>
              </div>
              <div class="video-info-item">
                <span class="video-info-label">Ï¥ù ÌîÑÎ†àÏûÑ:</span>
                <span class="video-info-value" id="videoTotalFrames">-</span>
              </div>
            </div>

            <!-- Ï≤òÎ¶¨Îê† ÎπÑÎîîÏò§ Ï†ïÎ≥¥ -->
            <div class="video-info-card">
              <div class="video-info-title">üé¨ Ï≤òÎ¶¨Îê† ÎπÑÎîîÏò§</div>
              <div class="video-info-item">
                <span class="video-info-label">Î≥ÄÍ≤Ω Ìï¥ÏÉÅÎèÑ:</span>
                <span class="video-info-value" id="processedResolution"
                  >ÏõêÎ≥∏Í≥º ÎèôÏùº</span
                >
              </div>
              <div class="video-info-item">
                <span class="video-info-label">Î∞∞Í≤Ω Ï†úÍ±∞:</span>
                <span class="video-info-value" id="backgroundRemoval"
                  >Ï†ÅÏö© ÏòàÏ†ï</span
                >
              </div>
              <div class="video-info-item">
                <span class="video-info-label">ÏóÖÏä§ÏºÄÏùº:</span>
                <span class="video-info-value" id="upscaleInfo">Ï†ÅÏö© ÏòàÏ†ï</span>
              </div>
              <div class="video-info-item">
                <span class="video-info-label">Ï∂úÎ†• Ìè¨Îß∑:</span>
                <span class="video-info-value">MP4 (H.264)</span>
              </div>
            </div>
          </div>

          <div class="action-buttons" id="leftVideoActionButtons">
            <button
              class="btn background-remove"
              onclick="showBackgroundColorPopup('remove_bg')"
            >
              ü´• Î∞∞Í≤Ω Ï†úÍ±∞
            </button>
            <button
              class="btn upscale-2x"
              onclick="startVideoProcessing('upscale_2x')"
            >
              üîç 2x ÏóÖÏä§ÏºÄÏùº
            </button>
            <button
              class="btn upscale-4x"
              onclick="startVideoProcessing('upscale_4x')"
            >
              üîç 4x ÏóÖÏä§ÏºÄÏùº
            </button>
            <button
              class="btn"
              onclick="showBackgroundColorPopup('both_2x')"
              style="
                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
              "
            >
              üé¨ Î∞∞Í≤ΩÏ†úÍ±∞ + 2x
            </button>
            <button
              class="btn"
              onclick="showBackgroundColorPopup('both_4x')"
              style="
                background: linear-gradient(135deg, #a55eea 0%, #8b2ac7 100%);
              "
            >
              üé¨ Î∞∞Í≤ΩÏ†úÍ±∞ + 4x
            </button>
          </div>
        </div>

        <input type="file" id="fileInput" accept="image/*" />
      </div>

      <!-- Ïö∞Ï∏° Ìå®ÎÑê -->
      <div class="right-panel" id="rightPanel">
        <!-- Îπà ÏÉÅÌÉú -->
        <div class="empty-state" id="emptyState">
          <div class="empty-icon" id="emptyIcon">üñºÔ∏è</div>
          <div class="empty-text" id="emptyText">
            Ïù¥ÎØ∏ÏßÄÎ•º Ï≤òÎ¶¨ÌïòÎ©¥<br />Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§
          </div>
        </div>

        <!-- Í≤∞Í≥º ÌëúÏãú ÏòÅÏó≠ -->
        <div class="image-display-area" id="rightImageArea">
          <div class="image-container">
            <img id="rightImage" class="image-display" alt="Ï≤òÎ¶¨ Í≤∞Í≥º" />
          </div>
          <div class="image-label" id="rightImageLabel">Ï≤òÎ¶¨ Í≤∞Í≥º</div>
          <div class="action-buttons" id="rightActionButtons">
            <button class="btn download" id="downloadBtn">üîΩ Îã§Ïö¥Î°úÎìú</button>
            <button
              class="btn upscale-2x"
              onclick="continueProcessing('upscale', 2)"
            >
              üîç 2x ÏóÖÏä§ÏºÄÏùº
            </button>
            <button
              class="btn upscale-4x"
              onclick="continueProcessing('upscale', 4)"
            >
              üîç 4x ÏóÖÏä§ÏºÄÏùº
            </button>
            <button
              class="btn background-remove"
              onclick="continueProcessing('background')"
            >
              ü´• Î∞∞Í≤Ω Ï†úÍ±∞
            </button>
          </div>
        </div>

        <!-- ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏÉÅÌÉú ÌëúÏãú ÏòÅÏó≠ -->
        <div class="video-status-area" id="videoStatusArea">
          <!-- Ï≤òÎ¶¨ Î©îÏãúÏßÄ (Ìå®ÎÑêÏóê ÏßÅÏ†ë ÌëúÏãú) -->
          <div
            class="processing-message"
            id="processingMessage"
            style="display: block"
          >
            <div class="processing-main-message" id="processingMainMessage">
              ü§ñ AIÍ∞Ä Ïó¥Ïã¨Ìûà ÏûëÏóÖÌïòÍ≥† ÏûàÏäµÎãàÎã§!
            </div>
            <div class="processing-tip-message" id="processingTipMessage">
              Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî ‚ú®
            </div>
          </div>

          <!-- ÎπÑÎîîÏò§ ÏôÑÎ£å Í≤∞Í≥º -->
          <div
            class="video-result-section"
            id="videoResultSection"
            style="display: none"
          >
            <div class="result-title">üéâ ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏôÑÎ£å!</div>
            <div class="action-buttons">
              <button class="btn download" id="videoDownloadBtn">
                üîΩ ÎπÑÎîîÏò§ Îã§Ïö¥Î°úÎìú
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Î∞∞Í≤Ω ÏÉâÏÉÅ ÏÑ†ÌÉù ÌåùÏóÖ -->
    <div class="background-color-popup" id="backgroundColorPopup">
      <div class="popup-content">
        <div class="popup-header">
          <div class="popup-title">üé® Î∞∞Í≤Ω ÏÉâÏÉÅ ÏÑ†ÌÉù</div>
          <button class="close-btn" onclick="hideBackgroundColorPopup()">
            √ó
          </button>
        </div>

        <div class="background-color-section">
          <div class="color-section-title">ÏÇ¨Ï†Ñ Ï†ïÏùò ÏÉâÏÉÅ</div>
          <div class="preset-colors">
            <button
              class="color-btn active"
              data-color="#FFFFFF"
              style="background: #ffffff; border: 3px solid #ddd"
              title="Ìù∞ÏÉâ"
            >
              ‚ö™
            </button>
            <button
              class="color-btn"
              data-color="#00FF00"
              style="background: #00ff00"
              title="Ï¥àÎ°ù (ÌÅ¨Î°úÎßàÌÇ§)"
            >
              üü¢
            </button>
            <button
              class="color-btn"
              data-color="#0000FF"
              style="background: #0000ff"
              title="ÌååÎûë (ÌÅ¨Î°úÎßàÌÇ§)"
            >
              üîµ
            </button>
            <button
              class="color-btn"
              data-color="#000000"
              style="background: #000000"
              title="Í≤ÄÏ†ï"
            >
              ‚ö´
            </button>
            <button
              class="color-btn"
              data-color="#FF0000"
              style="background: #ff0000"
              title="Îπ®Í∞ï"
            >
              üî¥
            </button>
            <button
              class="color-btn"
              data-color="#FFFF00"
              style="background: #ffff00"
              title="ÎÖ∏Îûë"
            >
              üü°
            </button>
            <button
              class="color-btn"
              data-color="#FF00FF"
              style="background: #ff00ff"
              title="ÏûêÏ£º"
            >
              üü£
            </button>
          </div>

          <div class="custom-color-section">
            <label for="popupCustomColorPicker">Ïª§Ïä§ÌÖÄ ÏÉâÏÉÅ:</label>
            <input
              type="color"
              id="popupCustomColorPicker"
              class="custom-color-picker"
              value="#FFFFFF"
            />
          </div>
        </div>

        <div class="popup-actions">
          <button class="popup-btn cancel" onclick="hideBackgroundColorPopup()">
            Ï∑®ÏÜå
          </button>
          <button class="popup-btn" onclick="confirmBackgroundColor()">
            ÌôïÏù∏ÌïòÍ≥† Ï≤òÎ¶¨ ÏãúÏûë
          </button>
        </div>
      </div>
    </div>

    <!-- ÌååÏùº ÏûÖÎ†• ÏöîÏÜåÎì§ -->
    <input type="file" id="fileInput" accept="image/*" />
    <input type="file" id="videoFileInput" accept="video/*" />

    <!-- Ï†ÑÏó≠ Ïª®Ìä∏Î°§ -->
    <div style="position: fixed; top: 20px; right: 20px; z-index: 1000">
      <button class="btn reset" onclick="resetApplication()">
        üîÑ Îã§Ïãú ÏãúÏûë
      </button>
    </div>

    <!-- Î©îÏãúÏßÄ Ïª®ÌÖåÏù¥ÎÑà -->
    <div class="message-container" id="messageContainer"></div>

    <script>
      // Î∞±ÏóîÎìúÎ°úÎ∂ÄÌÑ∞ Ï†ÑÎã¨Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞
      // Jinja2 ÌÖúÌîåÎ¶ø Íµ¨Î¨∏ÏùÑ ÏïàÏ†ÑÌïòÍ≤å Ï≤òÎ¶¨
      let workId = "";
      let workData = null;

      // ÏÑúÎ≤ÑÏóêÏÑú Ï†ÑÎã¨Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÎã§Î©¥ ÏÑ§Ï†ï
      try {
        const serverWorkId = document.querySelector('meta[name="work-id"]');

        console.log("üîç ÎîîÎ≤ÑÍπÖ - serverWorkId:", serverWorkId);

        if (serverWorkId) {
          workId = serverWorkId.content;
          console.log("‚úÖ workId ÏÑ§Ï†ïÎê®:", workId);
        }

        // work_dataÎäî script ÌÉúÍ∑∏ÏóêÏÑú ÏßÅÏ†ë ÏÑ§Ï†ïÎêú window.serverWorkData ÏÇ¨Ïö©
        if (window.serverWorkData) {
          workData = window.serverWorkData;
          console.log("‚úÖ workData ÏÑ§Ï†ïÎê® (script ÌÉúÍ∑∏):", workData);
        } else {
          console.log("‚ùå window.serverWorkDataÍ∞Ä ÏóÜÏùå");
        }
      } catch (e) {
        console.error("‚ùå ÏÑúÎ≤Ñ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï Ïã§Ìå®:", e);
      }

      // DOM ÏöîÏÜåÎì§
      const fileInput = document.getElementById("fileInput");
      const videoFileInput = document.getElementById("videoFileInput");
      const uploadArea = document.getElementById("uploadArea");
      const videoUploadArea = document.getElementById("videoUploadArea");
      const imageMode = document.getElementById("imageMode");
      const videoMode = document.getElementById("videoMode");
      const videoOptions = document.getElementById("videoOptions");
      const mainContainer = document.getElementById("mainContainer");
      const rightPanel = document.getElementById("rightPanel");
      const leftImageArea = document.getElementById("leftImageArea");
      const rightImageArea = document.getElementById("rightImageArea");
      const videoStatusArea = document.getElementById("videoStatusArea");
      const leftImage = document.getElementById("leftImage");
      const rightImage = document.getElementById("rightImage");
      const leftImageLabel = document.getElementById("leftImageLabel");
      const rightImageLabel = document.getElementById("rightImageLabel");
      const leftActionButtons = document.getElementById("leftActionButtons");
      const rightActionButtons = document.getElementById("rightActionButtons");
      const emptyState = document.getElementById("emptyState");
      const messageContainer = document.getElementById("messageContainer");
      const downloadBtn = document.getElementById("downloadBtn");

      // ÎπÑÎîîÏò§ Í¥ÄÎ†® DOM ÏöîÏÜåÎì§
      const leftVideoArea = document.getElementById("leftVideoArea");
      const leftVideo = document.getElementById("leftVideo");
      const leftVideoLabel = document.getElementById("leftVideoLabel");
      const leftVideoActionButtons = document.getElementById(
        "leftVideoActionButtons"
      );

      const videoResolution = document.getElementById("videoResolution");
      const videoFPS = document.getElementById("videoFPS");
      const videoTotalFrames = document.getElementById("videoTotalFrames");
      const processingMessage = document.getElementById("processingMessage");
      const processingMainMessage = document.getElementById(
        "processingMainMessage"
      );
      const processingTipMessage = document.getElementById(
        "processingTipMessage"
      );
      const videoResultSection = document.getElementById("videoResultSection");
      const videoDownloadBtn = document.getElementById("videoDownloadBtn");

      // Î∞∞Í≤Ω ÏÉâÏÉÅ ÌåùÏóÖ Í¥ÄÎ†® ÏöîÏÜåÎì§
      const backgroundColorPopup = document.getElementById(
        "backgroundColorPopup"
      );
      const popupCustomColorPicker = document.getElementById(
        "popupCustomColorPicker"
      );

      // ÌîÑÎ†àÏûÑ Ïπ¥Ïö¥ÌÑ∞ÏôÄ ÏãúÍ∞Ñ ÌëúÏãú ÏöîÏÜåÎì§ (ÏóÜÏúºÎ©¥ null)
      const currentFrameNumber = document.getElementById("currentFrameNumber");
      const remainingTime = document.getElementById("remainingTime");

      // Ï†ÑÏó≠ Î≥ÄÏàò
      let currentImageFile = null;
      let currentVideoFile = null;
      let currentDownloadUrl = null;
      let isTransparentImage = false;
      let currentMode = "image";
      let videoProcessingData = null;
      let messageInterval = null;
      let processingStartTime = null;
      let selectedBackgroundColor = "#FFFFFF"; // Í∏∞Î≥∏ Î∞∞Í≤ΩÏÉâ
      let pendingProcessingMode = null; // ÌåùÏóÖÏóêÏÑú ÏÑ†ÌÉùÎêú Ï≤òÎ¶¨ Î™®Îìú

      // Ïã§Ï†ú ÌîÑÎ†àÏûÑ Ï≤òÎ¶¨ ÏãúÏûë ÏãúÍ∞Ñ (window Í∞ùÏ≤¥Ïóê Ï†ÄÏû•)
      window.actualProcessingStartTime = null;

      // Ïû¨ÎØ∏ÏûàÎäî Î©îÏãúÏßÄÎì§
      const funMessages = [
        {
          msg: "ü§ñ AIÍ∞Ä Í∞Å ÌîÑÎ†àÏûÑÏùÑ ÍººÍººÌûà Î∂ÑÏÑùÌïòÍ≥† ÏûàÏñ¥Ïöî!",
          tip: "ÎÜíÏùÄ ÌíàÏßàÏùÑ ÏúÑÌï¥ÏÑúÎäî ÏãúÍ∞ÑÏù¥ Ï°∞Í∏à ÌïÑÏöîÌï¥Ïöî ‚ú®",
        },
        {
          msg: "üé® ÎßàÎ≤ïÍ∞ôÏùÄ Î∞∞Í≤Ω Ï†úÍ±∞Í∞Ä ÏßÑÌñâ Ï§ëÏù¥ÏóêÏöî!",
          tip: "Í≥ß ÎÜÄÎùºÏö¥ Í≤∞Í≥ºÎ•º Î≥¥Ïã§ Ïàò ÏûàÏùÑ Í±∞ÏòàÏöî üé≠",
        },
        {
          msg: "üîç Ïù¥ÎØ∏ÏßÄÎ•º Îçî ÏÑ†Î™ÖÌïòÍ≤å ÎßåÎì§Í≥† ÏûàÏñ¥Ïöî!",
          tip: "ÏóÖÏä§ÏºÄÏùºÎßÅÏùÄ ÌîΩÏÖÄ ÌïòÎÇòÌïòÎÇòÎ•º Ï†ïÍµêÌïòÍ≤å Ï≤òÎ¶¨Ìï¥Ïöî üéØ",
        },
        {
          msg: "‚ö° GPUÍ∞Ä Ïó¥Ïã¨Ìûà Í≥ÑÏÇ∞ÌïòÍ≥† ÏûàÏñ¥Ïöî!",
          tip: "AI Î™®Îç∏Ïù¥ Î≥µÏû°Ìïú Ïó∞ÏÇ∞ÏùÑ ÏàòÌñâ Ï§ëÏù¥ÏóêÏöî üß†",
        },
        {
          msg: "üé¨ ÏòÅÌôî Í∞ôÏùÄ ÌíàÏßàÎ°ú Î≥ÄÌôò Ï§ëÏù¥ÏóêÏöî!",
          tip: "ÌîÑÎ°úÌéòÏÖîÎÑêÌïú Í≤∞Í≥ºÎ¨ºÏùÑ ÎßåÎì§Ïñ¥ ÎìúÎ¶¥Í≤åÏöî üé™",
        },
        {
          msg: "üöÄ Í±∞Ïùò Îã§ ÏôîÏñ¥Ïöî! Ï°∞Í∏àÎßå Îçî Í∏∞Îã§Î†§ Ï£ºÏÑ∏Ïöî!",
          tip: "ÎßàÏßÄÎßâ ÎßàÎ¨¥Î¶¨ ÏûëÏóÖÏù¥ ÏßÑÌñâ Ï§ëÏù¥ÏóêÏöî ‚è∞",
        },
        {
          msg: "üåü Í∞Å ÌîÑÎ†àÏûÑÏóê ÌäπÎ≥ÑÌïú ÎßàÎ≤ïÏùÑ Í±∏Í≥† ÏûàÏñ¥Ïöî!",
          tip: "AIÍ∞Ä ÎîîÌÖåÏùºÍπåÏßÄ ÎÜìÏπòÏßÄ ÏïäÍ≥† Ï≤òÎ¶¨Ìï¥Ïöî üî¨",
        },
        {
          msg: "üé≠ Î∞∞Í≤ΩÍ≥º Í∞ùÏ≤¥Î•º Ï†ïÎ∞ÄÌïòÍ≤å Íµ¨Î∂ÑÌïòÍ≥† ÏûàÏñ¥Ïöî!",
          tip: "ÏàòÏ≤ú Î≤àÏùò ÌïôÏäµÏúºÎ°ú ÏôÑÏÑ±Îêú AI Í∏∞Ïà†Ïù¥ÏóêÏöî üìö",
        },
        {
          msg: "üíé Îã§Ïù¥ÏïÑÎ™¨ÎìúÏ≤òÎüº Ìà¨Î™ÖÌïòÍ≥† ÍπîÎÅîÌïòÍ≤å!",
          tip: "ÏôÑÎ≤ΩÌïú Ìà¨Î™ÖÎèÑ Ï≤òÎ¶¨Î•º ÏúÑÌï¥ ÎÖ∏Î†•ÌïòÍ≥† ÏûàÏñ¥Ïöî üíç",
        },
        {
          msg: "üé™ ÏÑúÏª§Ïä§Îã®Ïùò Í≥°ÏòàÏÇ¨Ï≤òÎüº Ï†ïÍµêÌïòÍ≤å!",
          tip: "Í∑†ÌòïÏû°Ìûå Ï≤òÎ¶¨Î°ú ÏûêÏó∞Ïä§Îü¨Ïö¥ Í≤∞Í≥ºÎ•º ÎßåÎì§Ïñ¥Ïöî ü§π",
        },
      ];

      const processingTips = [
        "üí° ÌåÅ: Ìï¥ÏÉÅÎèÑÍ∞Ä ÎÜíÏùÑÏàòÎ°ù Îçî Ïò§Îûò Í±∏Î¶¨ÏßÄÎßå ÌíàÏßàÎèÑ Ï¢ãÏïÑÏ†∏Ïöî!",
        "‚ö° ÌåÅ: GPU ÏÇ¨Ïö© Ïãú CPU ÎåÄÎπÑ 5-10Î∞∞ Îπ†Î•∏ Ï≤òÎ¶¨Í∞Ä Í∞ÄÎä•Ìï¥Ïöî!",
        "üéØ ÌåÅ: Î∞∞Í≤ΩÏù¥ Î≥µÏû°Ìï†ÏàòÎ°ù AIÍ∞Ä Îçî Ïó¥Ïã¨Ìûà Î∂ÑÏÑùÌï¥Ïöî!",
        "üåà ÌåÅ: Îã§ÏñëÌïú ÏÉâÏÉÅÏù¥ ÏûàÎäî ÏòÅÏÉÅÏùºÏàòÎ°ù Ï≤òÎ¶¨ ÏãúÍ∞ÑÏù¥ ÎäòÏñ¥ÎÇ† Ïàò ÏûàÏñ¥Ïöî!",
        "üì± ÌåÅ: Î™®Î∞îÏùºÏóêÏÑú Ï¥¨ÏòÅÌïú ÏòÅÏÉÅÎèÑ ÏôÑÎ≤ΩÌïòÍ≤å Ï≤òÎ¶¨ Í∞ÄÎä•Ìï¥Ïöî!",
        "üé® ÌåÅ: Ïï†ÎãàÎ©îÏù¥ÏÖòÏù¥ÎÇò Í∑∏ÎûòÌîΩ ÏòÅÏÉÅÎèÑ ÏßÄÏõêÌï¥Ïöî!",
        "‚≠ê ÌåÅ: Ïù∏Î¨º ÏòÅÏÉÅÏóêÏÑú ÌäπÌûà Îõ∞Ïñ¥ÎÇú ÏÑ±Îä•ÏùÑ Î≥¥Ïó¨Ï§çÎãàÎã§!",
        "üî• ÌåÅ: Ïã§ÏãúÍ∞ÑÏù¥ ÏïÑÎãå Í≥†ÌíàÏßà Ï≤òÎ¶¨Î•º ÏúÑÌï¥ ÏãúÍ∞ÑÏùÑ Ìà¨ÏûêÌïòÍ≥† ÏûàÏñ¥Ïöî!",
      ];

      // UUID ÏÉùÏÑ± Ìï®Ïàò
      function generateUUID() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
          /[xy]/g,
          function (c) {
            const r = (Math.random() * 16) | 0;
            const v = c == "x" ? r : (r & 0x3) | 0x8;
            return v.toString(16);
          }
        );
      }

      // Î™®ÎìúÎ≥Ñ Îπà ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
      function updateEmptyState() {
        const emptyIcon = document.getElementById("emptyIcon");
        const emptyText = document.getElementById("emptyText");

        if (currentMode === "video") {
          emptyIcon.textContent = "üé¨";
          emptyText.innerHTML =
            "ÎπÑÎîîÏò§Î•º Ï≤òÎ¶¨ÌïòÎ©¥<br />Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§";
        } else {
          emptyIcon.textContent = "üñºÔ∏è";
          emptyText.innerHTML =
            "Ïù¥ÎØ∏ÏßÄÎ•º Ï≤òÎ¶¨ÌïòÎ©¥<br />Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§";
        }
      }

      // Î™®Îìú Ï†ÑÌôò Ìï®Ïàò
      function switchMode(mode) {
        currentMode = mode;
        const tabs = document.querySelectorAll(".mode-tab");
        tabs.forEach((tab) => tab.classList.remove("active"));

        if (mode === "image") {
          tabs[0].classList.add("active");
          imageMode.classList.remove("hidden");
          videoMode.classList.remove("active");
          initializeApp();
        } else if (mode === "video") {
          tabs[1].classList.add("active");
          imageMode.classList.add("hidden");
          videoMode.classList.add("active");
          initializeVideoMode();
        }

        updateEmptyState();
      }

      // Ïù¥ÎØ∏ÏßÄ Î™®Îìú Ï¥àÍ∏∞Ìôî
      function initializeApp() {
        if (currentMode !== "image") return;

        uploadArea.style.display = "flex";
        leftImageArea.classList.remove("visible");
        leftVideoArea.classList.remove("visible"); // ÎπÑÎîîÏò§ ÏòÅÏó≠ Ïà®Í∏∞Í∏∞
        rightPanel.classList.remove("visible");
        videoStatusArea.classList.remove("visible"); // ÎπÑÎîîÏò§ ÏÉÅÌÉú ÏòÅÏó≠ Ïà®Í∏∞Í∏∞
        mainContainer.classList.add("upload-only");
        emptyState.classList.remove("hide");
        rightImageArea.classList.remove("visible");
        messageContainer.innerHTML = "";
        currentImageFile = null;
        currentDownloadUrl = null;
        isTransparentImage = false;
      }

      // ÎπÑÎîîÏò§ Î™®Îìú Ï¥àÍ∏∞Ìôî
      function initializeVideoMode() {
        videoUploadArea.style.display = "flex";
        leftVideoArea.classList.remove("visible");
        rightPanel.classList.remove("visible");
        videoStatusArea.classList.remove("visible");
        mainContainer.classList.add("upload-only");
        emptyState.classList.remove("hide");
        currentVideoFile = null;
        currentDownloadUrl = null;

        // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ Í¥ÄÎ†® Ï†ïÎ¶¨
        stopFileCountPolling();
        if (messageInterval) {
          clearInterval(messageInterval);
          messageInterval = null;
        }

        // Í≤∞Í≥º ÏòÅÏó≠ Ïà®Í∏∞Í∏∞
        if (videoResultSection) {
          videoResultSection.style.display = "none";
        }

        // Ï≤òÎ¶¨ Î©îÏãúÏßÄ Ïà®Í∏∞Í∏∞
        if (processingMessage) {
          processingMessage.style.display = "none";
        }
      }

      // ÏóÖÏä§ÏºÄÏùº ÏòµÏÖò ÌÜ†Í∏Ä (ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå - Ìò∏ÌôòÏÑ±ÏùÑ ÏúÑÌï¥ Ïú†ÏßÄ)
      function toggleScaleOptions() {
        // Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå - ÏÉàÎ°úÏö¥ UIÏóêÏÑúÎäî Î≤ÑÌäºÏúºÎ°ú ÏßÅÏ†ë ÏÑ†ÌÉù
      }

      // Î∞∞Í≤Ω ÏÉâÏÉÅ ÌåùÏóÖ ÌëúÏãú
      function showBackgroundColorPopup(mode) {
        console.log("üé® Î∞∞Í≤Ω ÏÉâÏÉÅ ÌåùÏóÖ ÌëúÏãú, mode:", mode);
        pendingProcessingMode = mode;
        backgroundColorPopup.style.display = "flex";

        // ÌåùÏóÖ ÎÇ¥ ÏÉâÏÉÅ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        initializePopupColorSelection();
      }

      // Î∞∞Í≤Ω ÏÉâÏÉÅ ÌåùÏóÖ Ïà®Í∏∞Í∏∞
      function hideBackgroundColorPopup() {
        console.log("üé® Î∞∞Í≤Ω ÏÉâÏÉÅ ÌåùÏóÖ Ïà®Í∏∞Í∏∞");
        backgroundColorPopup.style.display = "none";
        pendingProcessingMode = null;
      }

      // Î∞∞Í≤Ω ÏÉâÏÉÅ ÌôïÏù∏ ÌõÑ Ï≤òÎ¶¨ ÏãúÏûë
      function confirmBackgroundColor() {
        console.log(
          "‚úÖ Î∞∞Í≤Ω ÏÉâÏÉÅ ÌôïÏù∏, pendingProcessingMode:",
          pendingProcessingMode
        );
        if (pendingProcessingMode) {
          // Ï≤òÎ¶¨ Î™®ÎìúÎ•º ÏûÑÏãú Î≥ÄÏàòÏóê Ï†ÄÏû•
          const modeToProcess = pendingProcessingMode;
          hideBackgroundColorPopup(); // Ïù¥Ï†ú pendingProcessingModeÍ∞Ä nullÏù¥ Îê®
          startVideoProcessing(modeToProcess); // ÌïòÏßÄÎßå ÏûÑÏãú Î≥ÄÏàò ÏÇ¨Ïö©
        } else {
          console.error("‚ùå pendingProcessingModeÍ∞Ä ÏóÜÏäµÎãàÎã§!");
        }
      }

      // ÌåùÏóÖ ÎÇ¥ ÏÉâÏÉÅ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
      function initializePopupColorSelection() {
        const popupColorButtons =
          backgroundColorPopup.querySelectorAll(".color-btn");

        // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞ ÌõÑ ÏÉàÎ°ú ÏÑ§Ï†ï
        popupColorButtons.forEach((btn) => {
          btn.replaceWith(btn.cloneNode(true));
        });

        // ÏÉàÎ°úÏö¥ Î≤ÑÌäºÎì§Ïóê Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        const newPopupColorButtons =
          backgroundColorPopup.querySelectorAll(".color-btn");
        newPopupColorButtons.forEach((btn) => {
          btn.addEventListener("click", function () {
            newPopupColorButtons.forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            selectedBackgroundColor = this.getAttribute("data-color");
            console.log("ÌåùÏóÖÏóêÏÑú Î∞∞Í≤Ω ÏÉâÏÉÅ ÏÑ†ÌÉù:", selectedBackgroundColor);
          });
        });

        // Ïª§Ïä§ÌÖÄ ÏÉâÏÉÅ ÌîºÏª§
        if (popupCustomColorPicker) {
          popupCustomColorPicker.addEventListener("change", function () {
            newPopupColorButtons.forEach((b) => b.classList.remove("active"));
            selectedBackgroundColor = this.value;
            console.log(
              "ÌåùÏóÖÏóêÏÑú Ïª§Ïä§ÌÖÄ Î∞∞Í≤Ω ÏÉâÏÉÅ ÏÑ†ÌÉù:",
              selectedBackgroundColor
            );
          });
        }
      }

      // Ï≤òÎ¶¨ Î©îÏãúÏßÄ ÏóÖÎç∞Ïù¥Ìä∏ (Ìå®ÎÑêÏóê ÏßÅÏ†ë ÌëúÏãú)
      function updateProcessingMessage() {
        if (!processingMainMessage || !processingTipMessage) return;

        const randomMessage =
          funMessages[Math.floor(Math.random() * funMessages.length)];
        const randomTip =
          processingTips[Math.floor(Math.random() * processingTips.length)];

        processingMainMessage.textContent = randomMessage.msg;
        processingTipMessage.textContent =
          Math.random() > 0.5 ? randomMessage.tip : randomTip;
      }

      // ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖ
      function formatTime(seconds) {
        if (seconds < 60) return `${Math.round(seconds)}Ï¥à`;
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.round(seconds % 60);
        return `${minutes}Î∂Ñ ${remainingSeconds}Ï¥à`;
      }

      // ÎπÑÎîîÏò§ Ï†ïÎ≥¥ ÌëúÏãú (ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ Ï†ïÌôïÌïú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©)
      function displayVideoInfo(data) {
        // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ Ï†ïÌôïÌïú ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏
        videoProcessingData = {
          width: data.width,
          height: data.height,
          fps: data.fps,
          original_frames: data.original_frames,
          duration: data.duration || leftVideo.duration,
        };

        // ÏõêÎ≥∏ ÎπÑÎîîÏò§ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (ÏÑúÎ≤Ñ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©)
        const videoResolutionEl = document.getElementById("videoResolution");
        if (videoResolutionEl) {
          videoResolutionEl.textContent = `${data.width}x${data.height}`;
        }

        const videoFPSEl = document.getElementById("videoFPS");
        if (videoFPSEl) {
          videoFPSEl.textContent = `${data.fps.toFixed(1)} FPS`;
        }

        const videoTotalFramesEl = document.getElementById("videoTotalFrames");
        if (videoTotalFramesEl) {
          videoTotalFramesEl.textContent = `${data.original_frames}Í∞ú`;
        }

        console.log("ÎπÑÎîîÏò§ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:", videoProcessingData);
      }

      // Ï≤òÎ¶¨Îê† ÎπÑÎîîÏò§ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
      function updateProcessingInfo(removeBg, upscale, scaleRatio) {
        if (!videoProcessingData) return;

        // Î≥ÄÍ≤ΩÎê† Ìï¥ÏÉÅÎèÑ Í≥ÑÏÇ∞
        let newResolution = "ÏõêÎ≥∏Í≥º ÎèôÏùº";
        if (upscale) {
          const newWidth = videoProcessingData.width * scaleRatio;
          const newHeight = videoProcessingData.height * scaleRatio;
          newResolution = `${newWidth}x${newHeight} (${scaleRatio}x)`;
        }
        const processedResolutionEl = document.getElementById(
          "processedResolution"
        );
        if (processedResolutionEl) {
          processedResolutionEl.textContent = newResolution;
        }

        // Î∞∞Í≤Ω Ï†úÍ±∞ Ïó¨Î∂Ä
        const backgroundRemovalEl =
          document.getElementById("backgroundRemoval");
        if (backgroundRemovalEl) {
          backgroundRemovalEl.textContent = removeBg
            ? "‚úÖ Ï†ÅÏö©Îê®"
            : "‚ùå Ï†ÅÏö© ÏïàÌï®";
        }

        // ÏóÖÏä§ÏºÄÏùº Ï†ïÎ≥¥
        let upscaleText = "‚ùå Ï†ÅÏö© ÏïàÌï®";
        if (upscale) {
          upscaleText = `‚úÖ ${scaleRatio}x ÏóÖÏä§ÏºÄÏùº`;
        }
        const upscaleInfoEl = document.getElementById("upscaleInfo");
        if (upscaleInfoEl) {
          upscaleInfoEl.textContent = upscaleText;
        }
      }

      // ÌòÑÏû¨ ÌîÑÎ†àÏûÑ ÏóÖÎç∞Ïù¥Ìä∏ (Ïã§Ï†ú ÌååÏùº Ïàò Í∏∞Î∞ò)
      function updateCurrentFrame(processedCount, totalFrames) {
        // ÌòÑÏû¨ Ï≤òÎ¶¨Îêú ÌîÑÎ†àÏûÑ ÏàòÏôÄ ÎπÑÏú® ÌëúÏãú
        const progressPercent =
          totalFrames > 0 ? (processedCount / totalFrames) * 100 : 0;

        // Ï≤´ Î≤àÏß∏ ÌîÑÎ†àÏûÑ Ï≤òÎ¶¨ Ïãú Ïã§Ï†ú Ï≤òÎ¶¨ ÏãúÏûë ÏãúÍ∞Ñ Í∏∞Î°ù
        if (processedCount === 1 && !window.actualProcessingStartTime) {
          window.actualProcessingStartTime = Date.now();
          console.log("Ïã§Ï†ú ÌîÑÎ†àÏûÑ Ï≤òÎ¶¨ ÏãúÏûë ÏãúÍ∞Ñ Í∏∞Î°ù");
        }

        if (window.actualProcessingStartTime && processedCount > 0) {
          const elapsed =
            (Date.now() - window.actualProcessingStartTime) / 1000;
          const avgTimePerFrame = elapsed / processedCount;
          const remainingFrames = totalFrames - processedCount;
          const estimatedRemaining = remainingFrames * avgTimePerFrame;

          console.log(
            `üé¨ Ïã§ÏãúÍ∞Ñ ÏßÑÌñâÎ•†: ${processedCount}/${totalFrames} (${progressPercent.toFixed(
              1
            )}%) - Í≤ΩÍ≥º: ${elapsed.toFixed(
              1
            )}Ï¥à, ÌèâÍ∑†: ${avgTimePerFrame.toFixed(
              2
            )}Ï¥à/ÌîÑÎ†àÏûÑ, ÏòàÏÉÅ ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ${estimatedRemaining.toFixed(1)}Ï¥à`
          );
        }
      }

      // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏÉÅÌÉú ÌëúÏãú
      function showVideoProcessingStatus() {
        console.log("üé¨ showVideoProcessingStatus() Ìò∏Ï∂úÎê®");

        rightPanel.classList.add("visible");
        emptyState.classList.add("hide");
        rightImageArea.classList.remove("visible");
        videoStatusArea.classList.add("visible");
        mainContainer.classList.remove("upload-only");

        console.log(
          "üì∫ videoStatusArea ÌëúÏãú ÏÉÅÌÉú:",
          videoStatusArea.classList.contains("visible")
        );
        console.log("üìã processingMessage ÏöîÏÜå:", processingMessage);

        // Ï≤òÎ¶¨ Î©îÏãúÏßÄ Ï£ºÍ∏∞Ï†Å ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë
        updateProcessingMessage();
        messageInterval = setInterval(updateProcessingMessage, 8000); // 8Ï¥àÎßàÎã§ Î©îÏãúÏßÄ Î≥ÄÍ≤Ω

        // Ï≤òÎ¶¨ ÏãúÏûë ÏãúÍ∞Ñ Ï¥àÍ∏∞Ìôî
        processingStartTime = Date.now();
        window.actualProcessingStartTime = null; // Ïã§Ï†ú ÌîÑÎ†àÏûÑ Ï≤òÎ¶¨ ÏãúÏûë ÏãúÍ∞Ñ Ï¥àÍ∏∞Ìôî

        // Ï≤òÎ¶¨ Î©îÏãúÏßÄ ÌëúÏãú
        if (processingMessage) {
          processingMessage.style.display = "block";
          console.log("üí¨ processingMessage ÌëúÏãúÎê®");
        } else {
          console.error("‚ùå processingMessage ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå");
        }

        // Í≤∞Í≥º ÏÑπÏÖò Ïà®Í∏∞Í∏∞
        if (videoResultSection) {
          videoResultSection.style.display = "none";
        }

        console.log("‚úÖ ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏÉÅÌÉú ÌëúÏãú ÏôÑÎ£å");
      }

      // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏôÑÎ£å Ïãú Ï†ïÎ¶¨
      function hideVideoProcessingStatus() {
        console.log("üîß hideVideoProcessingStatus ÏãúÏûë");

        if (messageInterval) {
          clearInterval(messageInterval);
          messageInterval = null;
          console.log("üì¥ Î©îÏãúÏßÄ Ïù∏ÌÑ∞Î≤å Ï†ïÎ¶¨Îê®");
        }

        // Ï≤òÎ¶¨ Î©îÏãúÏßÄ Ïà®Í∏∞Í∏∞
        if (processingMessage) {
          processingMessage.style.display = "none";
          console.log("üì¥ Ï≤òÎ¶¨ Î©îÏãúÏßÄ Ïà®ÍπÄ");
        } else {
          console.error("‚ùå processingMessage ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå");
        }

        // Í≤∞Í≥º ÏòÅÏó≠ ÌëúÏãú
        if (videoResultSection) {
          videoResultSection.style.display = "block";
          console.log("üì∫ ÎπÑÎîîÏò§ Í≤∞Í≥º ÏÑπÏÖò ÌëúÏãúÎê®");
        } else {
          console.error("‚ùå videoResultSection ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå");
        }

        console.log("‚úÖ hideVideoProcessingStatus ÏôÑÎ£å");
      }

      // ÏÉàÎ°úÏö¥ ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏãúÏûë Ìï®Ïàò
      function startVideoProcessing(mode) {
        console.log("üé¨ startVideoProcessing Ìò∏Ï∂úÎê®, mode:", mode);

        if (!currentVideoFile) {
          showMessage("ÎπÑÎîîÏò§ ÌååÏùºÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.", "error");
          return;
        }

        let removeBg = false;
        let upscale = false;
        let scaleRatio = 2;

        // Î™®ÎìúÏóê Îî∞Î•∏ Ï≤òÎ¶¨ ÏòµÏÖò ÏÑ§Ï†ï
        console.log("üîß Ï≤òÎ¶¨ Î™®Îìú Î∂ÑÏÑù:", mode, typeof mode);
        switch (mode) {
          case "remove_bg":
            removeBg = true;
            break;
          case "upscale_2x":
            upscale = true;
            scaleRatio = 2;
            break;
          case "upscale_4x":
            upscale = true;
            scaleRatio = 4;
            break;
          case "both_2x":
            removeBg = true;
            upscale = true;
            scaleRatio = 2;
            break;
          case "both_4x":
            removeBg = true;
            upscale = true;
            scaleRatio = 4;
            break;
          default:
            console.error(
              "‚ùå Ïïå Ïàò ÏóÜÎäî Ï≤òÎ¶¨ Î™®Îìú:",
              mode,
              "ÌÉÄÏûÖ:",
              typeof mode
            );
            showMessage(`ÏûòÎ™ªÎêú Ï≤òÎ¶¨ Î™®ÎìúÏûÖÎãàÎã§: ${mode}`, "error");
            return;
        }

        // Ï≤òÎ¶¨ ÏãúÏûë Ï†ÑÏóê Ï≤òÎ¶¨Îê† ÎπÑÎîîÏò§ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        updateProcessingInfo(removeBg, upscale, scaleRatio);

        // Ï≤òÎ¶¨ ÏòµÏÖòÏùÑ Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû• (ÎÇòÏ§ëÏóê ÏÇ¨Ïö©)
        window.currentProcessingOptions = {
          removeBg: removeBg,
          upscale: upscale,
          scaleRatio: scaleRatio,
        };

        processVideoWithOptions(removeBg, upscale, scaleRatio);
      }

      // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ Ìï®Ïàò (ÏòµÏÖò Ìè¨Ìï®)
      function processVideoWithOptions(removeBg, upscale, scaleRatio) {
        console.log("üé¨ ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏãúÏûë - ÏòµÏÖò:", {
          removeBg,
          upscale,
          scaleRatio,
          backgroundColorValue: selectedBackgroundColor,
          workIdValue: workId,
          currentVideoFileExists: !!currentVideoFile,
        });

        if (!currentVideoFile) {
          console.error("‚ùå currentVideoFileÏù¥ ÏóÜÏäµÎãàÎã§!");
          showMessage("ÎπÑÎîîÏò§ ÌååÏùºÏù¥ ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.", "error");
          return;
        }

        const formData = new FormData();
        formData.append("file", currentVideoFile);
        formData.append("remove_bg", removeBg);
        formData.append("upscale", upscale);
        formData.append("scale_factor", scaleRatio);
        formData.append("background_color", selectedBackgroundColor); // Î∞∞Í≤Ω ÏÉâÏÉÅ Ï∂îÍ∞Ä
        // ÌîÑÎ°†Ìä∏ÏóîÎìúÏóêÏÑú ÏÉùÏÑ±Ìïú work_id Ï†ÑÎã¨
        if (workId) {
          formData.append("work_id", workId);
        }

        console.log("üì§ FormData Ï§ÄÎπÑ ÏôÑÎ£å:", {
          fileSize: currentVideoFile.size,
          fileName: currentVideoFile.name,
          backgroundColor: selectedBackgroundColor,
          workId: workId,
        });

        // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏÉÅÌÉú ÌëúÏãú ÏãúÏûë
        showVideoProcessingStatus();

        // Ï≤òÎ¶¨ Î≤ÑÌäºÎì§ ÎπÑÌôúÏÑ±Ìôî
        const actionButtons = leftVideoActionButtons.querySelectorAll(".btn");
        actionButtons.forEach((btn) => (btn.disabled = true));

        fetch("/process_video", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            // Ï≤òÎ¶¨ Î≤ÑÌäºÎì§ Ïû¨ÌôúÏÑ±Ìôî
            actionButtons.forEach((btn) => (btn.disabled = false));

            if (data.success) {
              // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ Ï†ïÌôïÌïú ÎπÑÎîîÏò§ Ï†ïÎ≥¥ ÌëúÏãú
              displayVideoInfo(data);

              // Ï≤òÎ¶¨ ÏòµÏÖòÏóê Îî∞Î•∏ Ï†ïÎ≥¥ Îã§Ïãú ÏóÖÎç∞Ïù¥Ìä∏ (Ï†ïÌôïÌïú Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò)
              if (window.currentProcessingOptions) {
                updateProcessingInfo(
                  window.currentProcessingOptions.removeBg,
                  window.currentProcessingOptions.upscale,
                  window.currentProcessingOptions.scaleRatio
                );
              }

              // ÌîÑÎ°úÍ∑∏Î†àÏä§ Ïä§Ìä∏Î¶º Ïó∞Í≤∞
              connectToVideoProgressStream(data.session_id, data);

              // ÌååÏùº Ïπ¥Ïö¥Ìä∏ Ìè¥ÎßÅ ÏãúÏûë (Ïã§Ï†ú ÌîÑÎ†àÏûÑ Ï≤òÎ¶¨ Ï∂îÏ†Å)
              startFileCountPolling(data.session_id);
            } else {
              showMessage(
                data.error || "ÎπÑÎîîÏò§ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.",
                "error"
              );
              stopFileCountPolling();
              if (messageInterval) {
                clearInterval(messageInterval);
                messageInterval = null;
              }
            }
          })
          .catch((error) => {
            // Ï≤òÎ¶¨ Î≤ÑÌäºÎì§ Ïû¨ÌôúÏÑ±Ìôî
            actionButtons.forEach((btn) => (btn.disabled = false));
            console.error("Error:", error);
            showMessage("ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
            stopFileCountPolling();
            if (messageInterval) {
              clearInterval(messageInterval);
              messageInterval = null;
            }
          });
      }

      // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
      uploadArea.addEventListener("click", () => fileInput.click());

      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFileUpload(files[0]);
        }
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          handleFileUpload(e.target.files[0]);
        }
      });

      // ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨
      function handleFileUpload(file) {
        // ÌååÏùº Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
        if (!file.type.startsWith("image/")) {
          showMessage("Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.", "error");
          return;
        }

        if (file.size > 16 * 1024 * 1024) {
          showMessage("ÌååÏùº ÌÅ¨Í∏∞Îäî 16MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.", "error");
          return;
        }

        // ÏóÖÎ°úÎìú Ï¶âÏãú UUID ÏÉùÏÑ±ÌïòÍ≥† URL Î≥ÄÍ≤Ω
        const newWorkId = generateUUID();
        workId = newWorkId;
        window.history.pushState(
          { workId: newWorkId },
          "",
          `/work/${newWorkId}`
        );
        console.log(`üìç Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ïãú URL Î≥ÄÍ≤Ω: /work/${newWorkId}`);

        currentImageFile = file;

        // Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
        const reader = new FileReader();
        reader.onload = (e) => {
          leftImage.src = e.target.result;
          leftImageLabel.textContent = ""; // ÎùºÎ≤® ÎπÑÏö∞Í∏∞

          // Ìà¨Î™ÖÎèÑ ÌôïÏù∏
          if (file.type === "image/png") {
            checkImageTransparency(e.target.result);
          }

          // UI Ï†ÑÌôò
          uploadArea.style.display = "none";
          leftImageArea.classList.add("visible");
          rightPanel.classList.add("visible");
          mainContainer.classList.remove("upload-only");

          // ÏóÖÎ°úÎìú ÏÉÅÌÉúÎ•º Ï¶âÏãú ÏÑúÎ≤ÑÏóê Ï†ÄÏû• + Ïù¥ÎØ∏ÏßÄÎèÑ localStorageÏóê Ï†ÄÏû•
          const formData = new FormData();
          formData.append("work_id", workId);
          formData.append("original_filename", file.name);

          // Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞Î•º localStorageÏóêÎèÑ Ï†ÄÏû•
          const imageDataUrl = e.target.result;
          localStorage.setItem(`uploaded_image_${workId}`, imageDataUrl);
          console.log(
            `üíæ Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ localStorage Ï†ÄÏû• ÏôÑÎ£å: uploaded_image_${workId}`
          );

          fetch("/save_upload_state", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                console.log(`‚úÖ ÏóÖÎ°úÎìú ÏÉÅÌÉú Ï†ÄÏû• ÏôÑÎ£å: ${workId}`);
                showMessage(
                  "Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§! ÏõêÌïòÎäî Ï≤òÎ¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",
                  "success"
                );
              } else {
                console.error("‚ùå ÏóÖÎ°úÎìú ÏÉÅÌÉú Ï†ÄÏû• Ïã§Ìå®:", data.error);
                showMessage(
                  "Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§! ÏõêÌïòÎäî Ï≤òÎ¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",
                  "success"
                );
              }
            })
            .catch((error) => {
              console.error("‚ùå ÏóÖÎ°úÎìú ÏÉÅÌÉú Ï†ÄÏû• ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò:", error);
              showMessage(
                "Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§! ÏõêÌïòÎäî Ï≤òÎ¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",
                "success"
              );
            });
        };
        reader.readAsDataURL(file);
      }

      // ÎπÑÎîîÏò§ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
      videoUploadArea.addEventListener("click", () => videoFileInput.click());

      videoUploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        videoUploadArea.classList.add("dragover");
      });

      videoUploadArea.addEventListener("dragleave", () => {
        videoUploadArea.classList.remove("dragover");
      });

      videoUploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        videoUploadArea.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleVideoUpload(files[0]);
        }
      });

      videoFileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          handleVideoUpload(e.target.files[0]);
        }
      });

      // ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú Ï≤òÎ¶¨
      function handleVideoUpload(file) {
        // ÌååÏùº Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
        if (!file.type.startsWith("video/")) {
          showMessage("ÎπÑÎîîÏò§ ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.", "error");
          return;
        }

        if (file.size > 100 * 1024 * 1024) {
          showMessage("ÌååÏùº ÌÅ¨Í∏∞Îäî 100MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.", "error");
          return;
        }

        // ÏóÖÎ°úÎìú Ï¶âÏãú UUID ÏÉùÏÑ±ÌïòÍ≥† URL Î≥ÄÍ≤Ω
        const newWorkId = generateUUID();
        workId = newWorkId;
        window.history.pushState(
          { workId: newWorkId },
          "",
          `/work/${newWorkId}`
        );
        console.log(`üìç ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú Ïãú URL Î≥ÄÍ≤Ω: /work/${newWorkId}`);

        currentVideoFile = file;

        // ÎπÑÎîîÏò§ ÌååÏùºÏùÑ URLÎ°ú Î≥ÄÌôòÌïòÏó¨ ÌëúÏãú
        const videoURL = URL.createObjectURL(file);
        leftVideo.src = videoURL;

        // UI Ï†ÑÌôò
        videoUploadArea.style.display = "none";
        leftVideoArea.classList.add("visible");
        rightPanel.classList.add("visible");
        mainContainer.classList.remove("upload-only");

        // Ïö∞Ï∏° Ìå®ÎÑêÏóê ÎπÑÎîîÏò§ ÏÉÅÌÉú ÌëúÏãú
        videoStatusArea.classList.add("visible");
        emptyState.classList.add("hide");

        // Ï≤òÎ¶¨ Î©îÏãúÏßÄ Ï¶âÏãú ÌëúÏãú (ÎåÄÍ∏∞ ÏÉÅÌÉú)
        if (processingMessage) {
          processingMessage.style.display = "block";
        }
        if (processingMainMessage) {
          processingMainMessage.textContent = "üé¨ ÎπÑÎîîÏò§Í∞Ä ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§!";
        }
        if (processingTipMessage) {
          processingTipMessage.textContent = "Ï≤òÎ¶¨Ìï† ÏûëÏóÖÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî ‚ú®";
        }

        // ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú ÏÉÅÌÉúÎ•º Ï¶âÏãú ÏÑúÎ≤ÑÏóê Ï†ÄÏû•
        const formData = new FormData();
        formData.append("work_id", workId);
        formData.append("original_filename", file.name);
        formData.append("video_type", "uploaded");

        // ÎπÑÎîîÏò§ URLÏùÑ localStorageÏóê Ï†ÄÏû• (Î≥µÏõêÏö©)
        localStorage.setItem(`uploaded_video_${workId}`, videoURL);
        localStorage.setItem(`uploaded_video_name_${workId}`, file.name);
        console.log(
          `üíæ ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞ localStorage Ï†ÄÏû• ÏôÑÎ£å: uploaded_video_${workId}`
        );

        fetch("/save_upload_state", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              console.log(`‚úÖ ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú ÏÉÅÌÉú Ï†ÄÏû• ÏôÑÎ£å: ${workId}`);
            } else {
              console.error("‚ùå ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú ÏÉÅÌÉú Ï†ÄÏû• Ïã§Ìå®:", data.error);
            }
          })
          .catch((error) => {
            console.error("‚ùå ÎπÑÎîîÏò§ ÏóÖÎ°úÎìú ÏÉÅÌÉú Ï†ÄÏû• ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò:", error);
          });

        // ÎπÑÎîîÏò§ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î°úÎìú Ïãú Ï¶âÏãú ÏõêÎ≥∏ Ï†ïÎ≥¥ ÌëúÏãú
        leftVideo.addEventListener("loadedmetadata", function initVideoData() {
          // Ïã§Ï†ú ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞Î°ú Ï¥àÍ∏∞Ìôî (Ï†ïÌôïÌïú FPSÎäî ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÑ ÏòàÏ†ï)
          videoProcessingData = {
            width: leftVideo.videoWidth,
            height: leftVideo.videoHeight,
            fps: null, // ÏÑúÎ≤ÑÏóêÏÑú Ï†ïÌôïÌïú Í∞íÏùÑ Î∞õÏùÑ ÏòàÏ†ï
            original_frames: null, // ÏÑúÎ≤ÑÏóêÏÑú Ï†ïÌôïÌïú Í∞íÏùÑ Î∞õÏùÑ ÏòàÏ†ï
            duration: leftVideo.duration,
          };

          // ÌååÏùº Ìè¨Îß∑ Ï†ïÎ≥¥ ÌëúÏãú
          const fileExtension = file.name.split(".").pop().toUpperCase();
          const videoFormatEl = document.getElementById("videoFormat");
          if (videoFormatEl) {
            videoFormatEl.textContent = fileExtension;
          }

          // Ìï¥ÏÉÅÎèÑ, FPS, ÌîÑÎ†àÏûÑ Ï†ïÎ≥¥ ÌëúÏãú
          const videoResolutionEl = document.getElementById("videoResolution");
          if (videoResolutionEl) {
            videoResolutionEl.textContent = `${videoProcessingData.width}x${videoProcessingData.height}`;
          }

          const videoFPSEl = document.getElementById("videoFPS");
          if (videoFPSEl) {
            videoFPSEl.textContent = `Î∂ÑÏÑù Ï§ë...`;
          }

          const videoTotalFramesEl =
            document.getElementById("videoTotalFrames");
          if (videoTotalFramesEl) {
            videoTotalFramesEl.textContent = `Î∂ÑÏÑù Ï§ë...`;
          }

          // Ï¥àÍ∏∞ Ï≤òÎ¶¨ Ï†ïÎ≥¥ ÏÑ§Ï†ï (ÏïÑÎ¨¥Í≤ÉÎèÑ Ï†ÅÏö© ÏïàÌï®)
          const processedResolutionEl = document.getElementById(
            "processedResolution"
          );
          if (processedResolutionEl) {
            processedResolutionEl.textContent = "ÏõêÎ≥∏Í≥º ÎèôÏùº";
          }

          const backgroundRemovalEl =
            document.getElementById("backgroundRemoval");
          if (backgroundRemovalEl) {
            backgroundRemovalEl.textContent = "Ï†ÅÏö© ÏòàÏ†ï";
          }

          const upscaleInfoEl = document.getElementById("upscaleInfo");
          if (upscaleInfoEl) {
            upscaleInfoEl.textContent = "Ï†ÅÏö© ÏòàÏ†ï";
          }

          // Ïù¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞
          leftVideo.removeEventListener("loadedmetadata", initVideoData);
        });

        const fileSizeMB = (file.size / (1024 * 1024)).toFixed(1);
        showMessage(
          `ÎπÑÎîîÏò§Í∞Ä ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§! (${fileSizeMB}MB) ÏõêÌïòÎäî Ï≤òÎ¶¨ ÏòµÏÖòÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.`,
          "success"
        );
      }

      // Ìà¨Î™ÖÎèÑ ÌôïÏù∏
      function checkImageTransparency(src) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;

          for (let i = 3; i < data.length; i += 4) {
            if (data[i] < 255) {
              isTransparentImage = true;
              if (leftImage.parentElement) {
                leftImage.parentElement.classList.add("transparency-bg");
              }
              break;
            }
          }
        };
        img.src = src;
      }

      // Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ (Ï¢åÏ∏°ÏóêÏÑú)
      function processImage(type, scale = 4) {
        if (!currentImageFile) {
          showMessage("Î®ºÏ†Ä Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.", "error");
          return;
        }

        emptyState.classList.add("hide");
        rightImageArea.classList.remove("visible");

        const formData = new FormData();
        formData.append("file", currentImageFile);
        // ÌîÑÎ°†Ìä∏ÏóîÎìúÏóêÏÑú ÏÉùÏÑ±Ìïú work_id Ï†ÑÎã¨
        if (workId) {
          formData.append("work_id", workId);
        }

        let endpoint = "/upload";
        let processingName = "Î∞∞Í≤Ω Ï†úÍ±∞";

        if (type === "upscale") {
          endpoint = "/upscale";
          formData.append("scale", scale.toString());
          processingName = `${scale}x ÏóÖÏä§ÏºÄÏùº`;
        }

        let progressStream = null;

        fetch(endpoint, {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              showMessage(data.error, "error");
            } else {
              // ÌîÑÎ°úÍ∑∏ÎûòÏä§ Ïä§Ìä∏Î¶º Ïó∞Í≤∞
              if (data.session_id) {
                progressStream = connectToProgressStream(data.session_id);
              }

              // Ï≤òÎ¶¨ ÏôÑÎ£å ÌõÑ Í≤∞Í≥º ÌëúÏãú
              setTimeout(() => {
                rightImage.src = data.download_url;
                rightImageLabel.textContent = `${processingName} ÏôÑÎ£å ‚ú®`;
                rightImageArea.classList.add("visible");

                // Î∞∞Í≤ΩÏ†úÍ±∞ Í≤∞Í≥ºÏù∏ Í≤ΩÏö∞ Ìà¨Î™ÖÎèÑ Î∞∞Í≤Ω Ï†ÅÏö©
                if (type === "background") {
                  rightImage.parentElement.classList.add("transparency-bg");
                  updateRightActionButtons(true);
                } else {
                  rightImage.parentElement.classList.remove("transparency-bg");
                  updateRightActionButtons(false);
                }

                currentDownloadUrl = data.download_url;
                setupDownloadButton();

                // localStorageÏóêÏÑú ÏûÑÏãú Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
                if (workId) {
                  localStorage.removeItem(`uploaded_image_${workId}`);
                  console.log(
                    `üßπ localStorage ÏûÑÏãú Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨ ÏôÑÎ£å: uploaded_image_${workId}`
                  );
                }

                showMessage(`${processingName}Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!`, "success");
              }, 1000);
            }
          })
          .catch((error) => {
            if (progressStream) {
              progressStream.close();
            }
            showMessage("Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
            console.error("Error:", error);
          });
      }

      // Ïó∞ÏÜç Ï≤òÎ¶¨ (Ïö∞Ï∏° Í≤∞Í≥ºÏóêÏÑú)
      function continueProcessing(type, scale = 4) {
        if (!currentDownloadUrl) {
          showMessage("Ï≤òÎ¶¨Ìï† Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.", "error");
          return;
        }

        // ÌòÑÏû¨ Í≤∞Í≥ºÎ•º Ï¢åÏ∏°ÏúºÎ°ú Ïù¥Îèô
        fetch(currentDownloadUrl)
          .then((response) => response.blob())
          .then((blob) => {
            const file = new File([blob], `processed_image.png`, {
              type: "image/png",
            });
            currentImageFile = file;

            // Ï¢åÏ∏° Ïù¥ÎØ∏ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
            leftImage.src = currentDownloadUrl;
            leftImageLabel.textContent = "ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ";

            // Ìà¨Î™ÖÎèÑ Î∞∞Í≤Ω Ï≤òÎ¶¨
            if (
              rightImage.parentElement.classList.contains("transparency-bg")
            ) {
              leftImage.parentElement.classList.add("transparency-bg");
            } else {
              leftImage.parentElement.classList.remove("transparency-bg");
            }

            // ÏÉàÎ°úÏö¥ Ï≤òÎ¶¨ ÏãúÏûë
            processImage(type, scale);
          })
          .catch((error) => {
            showMessage("Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
            console.error("Error:", error);
          });
      }

      // Ïö∞Ï∏° Ïï°ÏÖò Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
      function updateRightActionButtons(isBackgroundRemoved) {
        const buttons = rightActionButtons.querySelectorAll(".btn");
        buttons.forEach((btn) => {
          if (btn.classList.contains("background-remove")) {
            btn.style.display = isBackgroundRemoved ? "none" : "inline-block";
          }
        });
      }

      // Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÏÑ§Ï†ï
      function setupDownloadButton() {
        downloadBtn.onclick = () => {
          if (currentDownloadUrl) {
            window.open(currentDownloadUrl, "_blank");
          }
        };
      }

      // ÌîÑÎ°úÍ∑∏Î†àÏä§ Ïä§Ìä∏Î¶º Ïó∞Í≤∞ (Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄÏö©)
      function connectToProgressStream(sessionId) {
        const eventSource = new EventSource(`/progress/${sessionId}`);

        eventSource.onmessage = function (event) {
          try {
            const data = JSON.parse(event.data);
            console.log(
              `ÌîÑÎ°úÍ∑∏Î†àÏä§ ÏóÖÎç∞Ïù¥Ìä∏: ${data.progress}% - ${data.message}`
            );

            if (data.progress >= 100) {
              eventSource.close();
            }
          } catch (e) {
            console.error("Progress parsing error:", e);
          }
        };

        eventSource.onerror = function (event) {
          console.error("Progress stream error:", event);
          eventSource.close();
        };

        return eventSource;
      }

      // Ïã§Ï†ú ÌååÏùº Ïàò ÌôïÏù∏ Ìè¥ÎßÅ (ÌïµÏã¨ Í∏∞Îä•)
      let fileCountPollingInterval = null;
      let currentSessionId = null;

      function startFileCountPolling(sessionId) {
        currentSessionId = sessionId;

        // 2Ï¥àÎßàÎã§ Ïã§Ï†ú ÌååÏùº Ïàò ÌôïÏù∏
        fileCountPollingInterval = setInterval(async () => {
          try {
            const response = await fetch(`/video_progress_files/${sessionId}`);
            if (response.ok) {
              const data = await response.json();

              console.log(
                `Ïã§Ï†ú ÌååÏùº Ïàò Ìè¥ÎßÅ: processed=${data.processed_count}, total=${data.total_frames}, completed=${data.completed}`
              );

              // Ïã§Ï†ú ÌååÏùº Ïàò Í∏∞Î∞òÏúºÎ°ú ÌîÑÎ†àÏûÑ ÏóÖÎç∞Ïù¥Ìä∏
              updateCurrentFrame(data.processed_count, data.total_frames);

              // ÏôÑÎ£å Ï≤¥ÌÅ¨ - ÏÑúÎ≤ÑÏóêÏÑú completed=trueÏù¥Í±∞ÎÇò Ï≤òÎ¶¨Îêú ÌîÑÎ†àÏûÑ ÏàòÍ∞Ä Ï¥ù ÌîÑÎ†àÏûÑ ÏàòÏóê ÎèÑÎã¨ÌïòÎ©¥ ÏôÑÎ£å
              if (
                data.completed ||
                (data.processed_count >= data.total_frames &&
                  data.total_frames > 0)
              ) {
                console.log(
                  `üé¨ ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏôÑÎ£å! completed=${data.completed}, frames=${data.processed_count}/${data.total_frames}`
                );
                console.log("üìä ÏôÑÎ£å Îç∞Ïù¥ÌÑ∞:", data);

                clearInterval(fileCountPollingInterval);
                fileCountPollingInterval = null;

                // Ï≤òÎ¶¨ ÏôÑÎ£å Ï≤òÎ¶¨
                handleVideoProcessingComplete(data);
              }
            } else {
              console.log(
                `‚ùå Ìè¥ÎßÅ Ïã§Ìå® (${response.status}): ÏÑ∏ÏÖòÏù¥ Ï†ïÎ¶¨ÎêòÏóàÍ±∞ÎÇò ÏôÑÎ£åÎêòÏóàÏùÑ Ïàò ÏûàÏùå`
              );
              // 404 ÏóêÎü¨Í∞Ä ÏßÄÏÜçÎêòÎ©¥ 1Î∂Ñ ÌõÑ Ìè¥ÎßÅ Ï§ëÏßÄ
              if (response.status === 404) {
                const now = Date.now();
                if (!window.lastPollingErrorTime) {
                  window.lastPollingErrorTime = now;
                } else if (now - window.lastPollingErrorTime > 60000) {
                  // 1Î∂Ñ
                  console.log("üõë 1Î∂ÑÍ∞Ñ 404 ÏóêÎü¨ ÏßÄÏÜç, Ìè¥ÎßÅ Ï§ëÏßÄ");
                  clearInterval(fileCountPollingInterval);
                  fileCountPollingInterval = null;
                  showMessage(
                    "ÎπÑÎîîÏò§ Ï≤òÎ¶¨Í∞Ä ÏôÑÎ£åÎêòÏóàÏùÑ Ïàò ÏûàÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.",
                    "error"
                  );
                }
              }
            }
          } catch (error) {
            console.error("ÌååÏùº Ïàò Ìè¥ÎßÅ Ïò§Î•ò:", error);
          }
        }, 2000); // 2Ï¥àÎßàÎã§ Ìè¥ÎßÅ

        console.log(`ÌååÏùº Ïàò Ìè¥ÎßÅ ÏãúÏûë: session=${sessionId}`);
      }

      function stopFileCountPolling() {
        if (fileCountPollingInterval) {
          clearInterval(fileCountPollingInterval);
          fileCountPollingInterval = null;
          console.log("ÌååÏùº Ïàò Ìè¥ÎßÅ Ï§ëÏßÄ");
        }
      }

      // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏôÑÎ£å Ï≤òÎ¶¨
      function handleVideoProcessingComplete(data) {
        console.log("üéâ ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏôÑÎ£å Ï≤òÎ¶¨ ÏãúÏûë:", data);

        // ÏãúÍ∞Ñ Î≥ÄÏàò Ï†ïÎ¶¨
        processingStartTime = null;
        window.actualProcessingStartTime = null;

        // ÌååÏùº Ïπ¥Ïö¥Ìä∏ Ìè¥ÎßÅ Ï§ëÏßÄ
        stopFileCountPolling();

        // UI ÏôÑÎ£å Ï≤òÎ¶¨
        hideVideoProcessingStatus();

        // Îã§Ïö¥Î°úÎìú URL ÏÑ§Ï†ï (work_id Í∏∞Î∞ò)
        console.log("üîó Îã§Ïö¥Î°úÎìú URL ÏÑ§Ï†ï ÏãúÏûë:");
        console.log("  - data:", data);
        console.log(
          "  - data.download_url:",
          data ? data.download_url : "data ÏóÜÏùå"
        );
        console.log("  - workId:", workId);

        if (data && data.download_url) {
          currentDownloadUrl = data.download_url;
          console.log("‚úÖ Î∞±ÏóîÎìúÏóêÏÑú Î∞õÏùÄ URL ÏÇ¨Ïö©:", currentDownloadUrl);
        } else if (workId) {
          // work_idÎ•º Ïù¥Ïö©Ìï¥ Îã§Ïö¥Î°úÎìú URL ÏÉùÏÑ±
          currentDownloadUrl = `/download/${workId}`;
          console.log("üîß work_id Í∏∞Î∞ò URL ÏÉùÏÑ±:", currentDownloadUrl);
        } else {
          console.error(
            "‚ùå Îã§Ïö¥Î°úÎìú URLÏùÑ ÏÑ§Ï†ïÌï† Ïàò ÏóÜÏùå - data.download_urlÍ≥º workId Î™®Îëê ÏóÜÏùå"
          );
        }

        setupVideoDownloadButton();

        // localStorageÏóêÏÑú ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
        if (workId) {
          localStorage.removeItem(`uploaded_video_${workId}`);
          localStorage.removeItem(`uploaded_video_name_${workId}`);
          console.log(
            `üßπ localStorage ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨ ÏôÑÎ£å: uploaded_video_${workId}`
          );
        }

        // ÏôÑÎ£å Î©îÏãúÏßÄ
        showMessage("üéâ ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏôÑÎ£å!", "success");
      }

      // ÎπÑÎîîÏò§ ÌîÑÎ°úÍ∑∏Î†àÏä§ Ïä§Ìä∏Î¶º Ïó∞Í≤∞
      function connectToVideoProgressStream(sessionId, videoData) {
        const eventSource = new EventSource(`/progress/${sessionId}`);

        eventSource.onmessage = function (event) {
          try {
            const data = JSON.parse(event.data);

            console.log(
              `ÎπÑÎîîÏò§ ÌîÑÎ°úÍ∑∏Î†àÏä§: ${data.progress}% - ${data.message}`
            );

            if (data.progress >= 100) {
              // SSE ÏôÑÎ£å Ïã†Ìò∏ - Ïã§Ï†ú ÏôÑÎ£åÎäî ÌååÏùº Ïπ¥Ïö¥Ìä∏ Ìè¥ÎßÅÏóêÏÑú Ï≤òÎ¶¨
              console.log(
                "üì° SSE Ïä§Ìä∏Î¶ºÏóêÏÑú ÏôÑÎ£å Ïã†Ìò∏ Î∞õÏùå - ÌååÏùº Ïπ¥Ïö¥Ìä∏ Ìè¥ÎßÅÏù¥ Ïã§Ï†ú ÏôÑÎ£åÎ•º Ï≤òÎ¶¨Ìï®"
              );
              eventSource.close();
            }
          } catch (e) {
            console.error("Progress parsing error:", e);
            console.error("Raw event data:", event.data);
          }
        };

        eventSource.onerror = function (event) {
          console.error("Progress stream error:", event);
          eventSource.close();

          // Ïò§Î•ò Ïãú Ï†ïÎ¶¨
          if (messageInterval) {
            clearInterval(messageInterval);
            messageInterval = null;
          }
        };

        return eventSource;
      }

      // ÎπÑÎîîÏò§ Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÏÑ§Ï†ï
      function setupVideoDownloadButton() {
        console.log("üîß setupVideoDownloadButton ÏãúÏûë");
        console.log("üìã videoDownloadBtn ÏöîÏÜå:", videoDownloadBtn);
        console.log("üìã currentDownloadUrl:", currentDownloadUrl);

        if (videoDownloadBtn) {
          videoDownloadBtn.onclick = () => {
            console.log("üîΩ Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÌÅ¥Î¶≠Îê®, URL:", currentDownloadUrl);
            if (currentDownloadUrl) {
              window.open(currentDownloadUrl, "_blank");
            } else {
              console.error("‚ùå Îã§Ïö¥Î°úÎìú URLÏù¥ ÏóÜÏäµÎãàÎã§!");
            }
          };
          console.log("‚úÖ Îã§Ïö¥Î°úÎìú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï ÏôÑÎ£å");
        } else {
          console.error("‚ùå videoDownloadBtn ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå!");
        }
      }

      // Î©îÏãúÏßÄ ÌëúÏãú
      function showMessage(message, type = "error") {
        messageContainer.innerHTML = `
          <div class="${type}-message">
            ${message}
          </div>
        `;

        setTimeout(() => {
          messageContainer.innerHTML = "";
        }, 3000);
      }

      // Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Î¶¨ÏÖã
      function resetApplication() {
        // work_idÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ ÏÑúÎ≤ÑÏóê Î¶¨ÏÖã ÏöîÏ≤≠ ÌõÑ Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        if (workId && workId.trim() !== "") {
          // ÏÑúÎ≤ÑÏóê ÏÑ∏ÏÖò Î¶¨ÏÖã ÏöîÏ≤≠
          fetch(`/reset/${workId}`, {
            method: "POST",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                console.log("üßπ ÏÑúÎ≤Ñ ÏÑ∏ÏÖò Ï†ïÎ¶¨ ÏôÑÎ£å:", data.cleaned_items);
                showMessage(
                  "ÏûëÏóÖÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§. Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.",
                  "success"
                );

                // 1Ï¥à ÌõÑ Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                setTimeout(() => {
                  window.location.href = "/";
                }, 1000);
              } else {
                console.error("ÏÑ∏ÏÖò Î¶¨ÏÖã Ïã§Ìå®:", data.error);
                // ÏÑúÎ≤Ñ Î¶¨ÏÖã Ïã§Ìå® ÏãúÏóêÎèÑ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏°ÏóêÏÑú ÌéòÏù¥ÏßÄ Ïù¥Îèô
                showMessage("Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.", "success");
                setTimeout(() => {
                  window.location.href = "/";
                }, 1000);
              }
            })
            .catch((error) => {
              console.error("Î¶¨ÏÖã ÏöîÏ≤≠ Ïò§Î•ò:", error);
              // ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò ÏãúÏóêÎèÑ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏°ÏóêÏÑú ÌéòÏù¥ÏßÄ Ïù¥Îèô
              showMessage("Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.", "success");
              setTimeout(() => {
                window.location.href = "/";
              }, 1000);
            });
        } else {
          // work_idÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ (Î©îÏù∏ ÌéòÏù¥ÏßÄÏóêÏÑú) Î°úÏª¨ Î¶¨ÏÖãÎßå ÏàòÌñâ
          performLocalReset();
        }
      }

      // Î°úÏª¨ ÏÉÅÌÉú Î¶¨ÏÖã (Í∏∞Ï°¥ Î°úÏßÅ)
      function performLocalReset() {
        fileInput.value = "";
        videoFileInput.value = "";

        // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ Í¥ÄÎ†® Ï†ïÎ¶¨
        if (messageInterval) {
          clearInterval(messageInterval);
          messageInterval = null;
        }

        // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
        videoProcessingData = null;
        processingStartTime = null;
        currentDownloadUrl = null;
        currentVideoFile = null;
        currentImageFile = null;
        pendingProcessingMode = null;

        // ÌåùÏóÖ Îã´Í∏∞
        if (backgroundColorPopup) {
          backgroundColorPopup.style.display = "none";
        }

        // ÎπÑÎîîÏò§ URL Ï†ïÎ¶¨ (Î©îÎ™®Î¶¨ ÎàÑÏàò Î∞©ÏßÄ)
        if (leftVideo && leftVideo.src) {
          URL.revokeObjectURL(leftVideo.src);
          leftVideo.src = "";
        }

        if (currentMode === "image") {
          initializeApp();
        } else {
          initializeVideoMode();
        }

        showMessage("Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.", "success");
      }

      // Ï¥àÍ∏∞Ìôî Î∞è ÏÉÅÌÉú Î≥µÏõê
      function initializeAppWithRestore() {
        // work_dataÍ∞Ä ÏûàÏúºÎ©¥ ÏÉÅÌÉú Î≥µÏõê
        if (workData) {
          console.log("‚úÖ ÏûëÏóÖ ÏÉÅÌÉú Î≥µÏõê ÏãúÏûë:", workData);

          if (
            workData.completed &&
            (workData.type === "image" || workData.type === "upscale")
          ) {
            // ÏôÑÎ£åÎêú Ïù¥ÎØ∏ÏßÄ/ÏóÖÏä§ÏºÄÏùº ÏûëÏóÖ Î≥µÏõê
            currentMode = "image";
            switchMode("image");

            // UI ÏÉÅÌÉú ÏÑ§Ï†ï
            uploadArea.style.display = "none";
            leftImageArea.classList.add("visible");
            rightPanel.classList.add("visible");
            rightImageArea.classList.add("visible");
            emptyState.classList.add("hide");
            mainContainer.classList.remove("upload-only");

            // Ï¢åÏ∏° Ìå®ÎÑê - ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ ÌëúÏãú (Ï≤òÎ¶¨Îêú Ïù¥ÎØ∏ÏßÄÎ•º Î≥¥Ïó¨Ï§å)
            leftImage.src = workData.download_url;
            leftImageLabel.textContent = ""; // ÎùºÎ≤® ÎπÑÏö∞Í∏∞

            // Ïö∞Ï∏° Ìå®ÎÑê - Ï≤òÎ¶¨ Í≤∞Í≥ºÎèÑ ÎèôÏùºÌïòÍ≤å ÌëúÏãú (ÏÇ¨Ïö©ÏûêÍ∞Ä Í≥ÑÏÜç ÏûëÏóÖÌï† Ïàò ÏûàÎèÑÎ°ù)
            rightImage.src = workData.download_url;
            rightImageLabel.textContent =
              workData.type === "upscale"
                ? `${workData.scale}x ÏóÖÏä§ÏºÄÏùº ÏôÑÎ£å ‚ú®`
                : "Î∞∞Í≤Ω Ï†úÍ±∞ ÏôÑÎ£å ‚ú®";

            // ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ ÌååÏùº ÏÉÅÌÉú ÏÑ§Ï†ï (Ï∂îÍ∞Ä Ï≤òÎ¶¨Î•º ÏúÑÌï¥)
            fetch(workData.download_url)
              .then((response) => response.blob())
              .then((blob) => {
                currentImageFile = new File([blob], workData.filename, {
                  type: "image/png",
                });
                console.log(
                  "üìÅ currentImageFile Î≥µÏõêÎê®:",
                  currentImageFile.name
                );
              })
              .catch((error) => {
                console.error("‚ùå Ïù¥ÎØ∏ÏßÄ ÌååÏùº Î≥µÏõê Ïã§Ìå®:", error);
              });

            // Ìà¨Î™ÖÎèÑ Î∞∞Í≤Ω ÏÑ§Ï†ï (Î∞∞Í≤Ω Ï†úÍ±∞Ïù∏ Í≤ΩÏö∞)
            if (workData.type === "image") {
              rightImage.parentElement.classList.add("transparency-bg");
              updateRightActionButtons(true);
            } else {
              rightImage.parentElement.classList.remove("transparency-bg");
              updateRightActionButtons(false);
            }

            // Îã§Ïö¥Î°úÎìú URL ÏÑ§Ï†ï
            currentDownloadUrl = workData.download_url;
            setupDownloadButton();
          } else if (workData.type === "uploaded" && !workData.completed) {
            // ÏóÖÎ°úÎìúÎßå Îêú ÏÉÅÌÉú Î≥µÏõê (Ï≤òÎ¶¨Îäî ÏïÑÏßÅ Ïïà Ìï®)
            console.log("üì§ ÏóÖÎ°úÎìúÎßå Îêú ÏÉÅÌÉú Î≥µÏõê:", workData);

            if (workData.video_type === "uploaded") {
              // ÎπÑÎîîÏò§ ÏóÖÎ°úÎìúÎßå Îêú ÏÉÅÌÉú Î≥µÏõê
              currentMode = "video";
              switchMode("video");

              // UI ÏÉÅÌÉú ÏÑ§Ï†ï
              videoUploadArea.style.display = "none";
              leftVideoArea.classList.add("visible");
              rightPanel.classList.add("visible");
              videoStatusArea.classList.add("visible");
              emptyState.classList.add("hide");
              mainContainer.classList.remove("upload-only");

              // localStorageÏóêÏÑú ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
              const savedVideoURL = localStorage.getItem(
                `uploaded_video_${workId}`
              );
              const savedVideoName = localStorage.getItem(
                `uploaded_video_name_${workId}`
              );

              if (savedVideoURL && savedVideoName) {
                leftVideo.src = savedVideoURL;
                console.log(
                  `üìÅ localStorageÏóêÏÑú ÎπÑÎîîÏò§ Î≥µÏõê ÏôÑÎ£å: uploaded_video_${workId}`
                );

                // Ï≤òÎ¶¨ Î©îÏãúÏßÄ ÌëúÏãú (ÎåÄÍ∏∞ ÏÉÅÌÉú)
                if (processingMessage) {
                  processingMessage.style.display = "block";
                }
                if (processingMainMessage) {
                  processingMainMessage.textContent =
                    "üé¨ ÏóÖÎ°úÎìúÎêú ÎπÑÎîîÏò§Í∞Ä Î≥µÏõêÎêòÏóàÏäµÎãàÎã§!";
                }
                if (processingTipMessage) {
                  processingTipMessage.textContent =
                    "Ï≤òÎ¶¨Ìï† ÏûëÏóÖÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî ‚ú®";
                }

                showMessage(
                  "‚úÖ Ïù¥Ï†ÑÏóê ÏóÖÎ°úÎìúÎêú ÎπÑÎîîÏò§Í∞Ä Î≥µÏõêÎêòÏóàÏäµÎãàÎã§! Ï≤òÎ¶¨Î•º Í≥ÑÏÜçÌïòÏÑ∏Ïöî.",
                  "success"
                );
              } else {
                // localStorageÏóê ÎπÑÎîîÏò§Í∞Ä ÏóÜÎäî Í≤ΩÏö∞
                if (processingMainMessage) {
                  processingMainMessage.textContent =
                    "‚ö†Ô∏è ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§";
                }
                if (processingTipMessage) {
                  processingTipMessage.textContent = "Îã§Ïãú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî";
                }
                showMessage(
                  "‚ö†Ô∏è Ïù¥Ï†Ñ ÏóÖÎ°úÎìú Ï†ïÎ≥¥Îäî ÏûàÏßÄÎßå ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Îã§Ïãú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.",
                  "error"
                );
              }
            } else {
              // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìúÎßå Îêú ÏÉÅÌÉú Î≥µÏõê
              currentMode = "image";
              switchMode("image");

              // UI ÏÉÅÌÉú ÏÑ§Ï†ï (Ïö∞Ï∏° Ìå®ÎÑêÏùÄ Îπà ÏÉÅÌÉúÎ°ú)
              uploadArea.style.display = "none";
              leftImageArea.classList.add("visible");
              rightPanel.classList.add("visible");
              emptyState.classList.remove("hide");
              rightImageArea.classList.remove("visible");
              mainContainer.classList.remove("upload-only");

              // localStorageÏóêÏÑú ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
              const savedImageData = localStorage.getItem(
                `uploaded_image_${workId}`
              );
              if (savedImageData) {
                leftImage.src = savedImageData;
                leftImageLabel.textContent = ""; // ÎùºÎ≤® ÎπÑÏö∞Í∏∞

                console.log(
                  `üìÅ localStorageÏóêÏÑú Ïù¥ÎØ∏ÏßÄ Î≥µÏõê ÏôÑÎ£å: uploaded_image_${workId}`
                );

                // currentImageFile Î≥µÏõê (Ï∂îÍ∞Ä Ï≤òÎ¶¨Î•º ÏúÑÌï¥)
                fetch(savedImageData)
                  .then((response) => response.blob())
                  .then((blob) => {
                    currentImageFile = new File(
                      [blob],
                      workData.original_filename,
                      {
                        type: "image/png",
                      }
                    );
                    console.log(
                      "üìÅ ÏóÖÎ°úÎìúÎêú currentImageFile Î≥µÏõêÎê®:",
                      currentImageFile.name
                    );
                  })
                  .catch((error) => {
                    console.error("‚ùå ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ ÌååÏùº Î≥µÏõê Ïã§Ìå®:", error);
                  });

                // ÏóÖÎ°úÎìúÎêú ÏÉÅÌÉú Î©îÏãúÏßÄ
                showMessage(
                  "‚úÖ Ïù¥Ï†ÑÏóê ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄÍ∞Ä Î≥µÏõêÎêòÏóàÏäµÎãàÎã§! Ï≤òÎ¶¨Î•º Í≥ÑÏÜçÌïòÏÑ∏Ïöî.",
                  "success"
                );
              } else {
                // localStorageÏóê Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ (Ïù¥Ï†Ñ Î≤ÑÏ†Ñ Ìò∏ÌôòÏÑ± ÎòêÎäî localStorage ÏÇ≠Ï†úÎê®)
                leftImageLabel.textContent = ""; // ÎùºÎ≤® ÎπÑÏö∞Í∏∞
                showMessage(
                  "‚ö†Ô∏è Ïù¥Ï†Ñ ÏóÖÎ°úÎìú Ï†ïÎ≥¥Îäî ÏûàÏßÄÎßå Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Îã§Ïãú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.",
                  "error"
                );
              }
            }
          } else if (workData.completed && workData.type === "video") {
            // ÏôÑÎ£åÎêú ÎπÑÎîîÏò§ ÏûëÏóÖ Î≥µÏõê
            currentMode = "video";
            switchMode("video");

            // UI ÏÉÅÌÉú ÏÑ§Ï†ï
            videoUploadArea.style.display = "none";
            rightPanel.classList.add("visible");
            videoStatusArea.classList.add("visible");
            emptyState.classList.add("hide");
            mainContainer.classList.remove("upload-only");

            // ÎπÑÎîîÏò§ Ï≤òÎ¶¨ ÏôÑÎ£å ÏÉÅÌÉú ÌëúÏãú
            hideVideoProcessingStatus();

            // Îã§Ïö¥Î°úÎìú URL ÏÑ§Ï†ï
            currentDownloadUrl = workData.download_url;
            setupVideoDownloadButton();

            console.log("üìπ ÎπÑÎîîÏò§ ÏÉÅÌÉú Î≥µÏõê ÏôÑÎ£å:", {
              filename: workData.filename,
              processing_info: workData.processing_info,
              download_url: workData.download_url,
            });
          }

          showMessage("‚úÖ Ïù¥Ï†Ñ ÏûëÏóÖ ÏÉÅÌÉúÍ∞Ä Î≥µÏõêÎêòÏóàÏäµÎãàÎã§!", "success");
          console.log("üéâ ÏÉÅÌÉú Î≥µÏõê ÏôÑÎ£å");
        } else {
          // ÏÉà ÏûëÏóÖ ÏãúÏûë
          console.log("üÜï ÏÉà ÏûëÏóÖ ÏãúÏûë");
          initializeApp();
        }
      }

      // Ï¥àÍ∏∞Ìôî
      document.addEventListener("DOMContentLoaded", function () {
        initializeAppWithRestore();
      });
    </script>
  </body>
</html>
